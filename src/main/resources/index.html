<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Crud Hospital</title>

    <script  >

        function fetchPatients() {
            const patients = fetch("http://127.0.0.1:8080/patients",{
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json'
                }
            }).then(response => response.json());
            return patients
        }
        function postPatient(patient) {
            fetch("http://127.0.0.1:8080/patients/createPatient", {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
        body: JSON.stringify(patient)}).then(response => console.log(response))
        }
        function upPatient(patient,id) {
            fetch(`http://127.0.0.1:8080/patients/${id}/updateInfo`, {
                method: 'PUT',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(patient)
            })
                .then(response => response.json())
                ;
        }
        function deletePatient(id) {
            fetchPatients(`htttp://127.0.0.1:8080/patients/delete/${id}`, {
                method: 'DELETE'
            })
        }
    </script>
    <script src="https://unpkg.com/petite-vue" defer init></script>
</head>
<body>
<!-- There has to be a simpler way of doing this, there is no way this is even remotely optimal.-->
<div v-scope="{async submitPatient(){
await postPatient(this.patient);
this.getPatients();},
 patient: { name: { firstName: '', lastName: '' }, age: '', email: '', gender: '', dateOfBirth: '', nationalHealthNumber: '' }
 ,patients: [],
 async getPatients() {
 this.patients = await fetchPatients();}, updatePatientData: {
        name: { firstName: '', lastName: '' },
        age: '',
        email: '',
        gender: '',
        dateOfBirth: '',
        nationalHealthNumber: ''
    },isUpdating:false,
    updateId:null,
 async updatePatient(){
    await upPatient(this.updatePatientData,this.updateId);
    this.getPatients();},
 showUpdateForm(patient, id) {
        this.updatePatientData = JSON.parse(JSON.stringify(patient));
        this.isUpdating = true;
        this.updateId = id;
    },
    submitUpdate() {
        this.updatePatient(this.updatePatientData, this.updateId);
    }}"  >
<form @submit.prevent="submitPatient">
    <label>
        First Name:
        <input v-model="patient.name.firstName">
    </label>
    <br>
    <label>
        Last Name:
        <input v-model="patient.name.lastName">
    </label>
    <br>
    <label>
        Age:
        <input type="number" v-model="patient.age">
    </label>
    <br>
    <label>
        Email
        <input type="email" v-model="patient.email">
    </label>
    <br>
    <label>
        Gender:
        <br>
        <label>
            Male:
            <input v-model="patient.gender" type="radio" value="MALE" >
        </label>
        <label>
            Female:
        <input v-model="patient.gender" type="radio" value="FEMALE" >
        </label>
        <label>
            Other:
            <input v-model="patient.gender" type="radio" value="OTHER" >
        </label>

    </label>
    <br>
    <label>
        Date of Birth:
        <input v-model="patient.dateOfBirth">
    </label>
    <br>
    <label>
        National Health Number:
        <input v-model="patient.nationalHealthNumber">
    </label>
    <br>
    <button type="submit">Create Patient</button>
</form>

<div id="patientRes">
    <div v-for="patient in patients" :key="patient.email" class="patient" >
        <br>
        <strong>Name: </strong> {{ patient.name.firstName }} {{ patient.name.lastName }}<br>
        <strong>Email: </strong> {{ patient.email }}      <button @click="showUpdateForm(patient,patient.id)">Update Patient Info</button> <br>
        <strong>National Health Number</strong> {{ patient.nationalHealthNumber}}<br><br>
    </div>
</div>
    <div v-if="isUpdating">
        <h3>Update Patient</h3>
        <form @submit.prevent="submitUpdate">
            <label>
                First Name:
                <input v-model="updatePatientData.name.firstName">
            </label>
            <br>
            <label>
                Last Name:
                <input v-model="updatePatientData.name.lastName">
            </label>
            <br>
            <label>
                Age:
                <input type="number" v-model="updatePatientData.age">
            </label>
            <br>
            <label>
                Email
                <input type="email" v-model="updatePatientData.email">
            </label>
            <br>
            <label>
                Gender:
                <br>
                <label>
                    Male:
                    <input v-model="updatePatientData.gender" type="radio" value="MALE">
                </label>
                <label>
                    Female:
                    <input v-model="updatePatientData.gender" type="radio" value="FEMALE">
                </label>
                <label>
                    Other:
                    <input v-model="updatePatientData.gender" type="radio" value="OTHER">
                </label>
            </label>
            <br>
            <label>
                Date of Birth:
                <input v-model="updatePatientData.dateOfBirth">
            </label>
            <br>
            <label>
                National Health Number:
                <input v-model="updatePatientData.nationalHealthNumber">
            </label>
            <br>
            <button type="submit">Update Patient</button>
            <button @click="isUpdating = false">Cancel</button>
        </form>
    </div>
</div>

</body>
</html>